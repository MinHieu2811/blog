import React, { useState, useEffect } from 'react'
import dynamic from 'next/dynamic'
import { useSpring, animated } from '@react-spring/web'

const LoadingPlaceholder = () => {
  return (
    <div className="flex w-full h-full items-center justify-center">
      <svg
        className="size-7 animate-spin ..."
        fill="none"
        stroke="currentColor"
        strokeLinecap="round"
        strokeLinejoin="round"
        strokeWidth="2"
        viewBox="0 0 24 24"
      >
        <path d="M21 12a9 9 0 1 1-6.219-8.56" />
      </svg>
    </div>
  )
}

const LazyVoxelDog = dynamic(() => import('./VoxelDog'), {
  loading: LoadingPlaceholder,
  ssr: false
})

const SunRay = ({ delay = 0, children }: { delay?: number; children: React.ReactNode }) => {
  const [isVisible, setIsVisible] = useState(false)

  useEffect(() => {
    const timer = setTimeout(() => {
      setIsVisible(true)
    }, delay * 100)

    return () => clearTimeout(timer)
  }, [delay])

  const springs = useSpring({
    from: { opacity: 0 },
    to: isVisible ? { opacity: 1 } : { opacity: 0 },
    config: {
      tension: 280,
      friction: 20
    }
  })

  const AnimatedGroup = animated.g as any

  return <AnimatedGroup style={springs}>{children}</AnimatedGroup>
}

const Sun = () => {
  return (
    <svg
      className="upper-sky-svg ml-[-110px] h-[456px]"
      fill="none"
      height="610"
      viewBox="0 0 610 610"
      width="610"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clipPath="url(#clip0_2006_9)">
        {/* Sun rays group */}
        <g className="sun-rays">
          <SunRay delay={4}>
            <path
              d="M148.926 65.577C147.592 63.3586 146.713 60.8969 146.341 58.3355C145.968 55.7741 146.108 53.1641 146.754 50.6575C147.4 48.151 148.539 45.7981 150.103 43.7358C151.667 41.6735 153.626 39.9432 155.866 38.6455C158.105 37.3478 160.581 36.5088 163.148 36.1773C165.715 35.8458 168.322 36.0285 170.818 36.7146C173.314 37.4008 175.648 38.5768 177.685 40.174C179.722 41.7713 181.421 43.7579 182.682 46.0181L207.801 89.3555C209.871 96 211.179 99.1839 209.871 104.216C208.563 109.248 205.309 113.554 200.826 116.187C196.343 118.82 190.998 119.565 185.966 118.257C180.934 116.949 176.628 113.695 173.995 109.212L148.926 65.577Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={6}>
            <path
              d="M289.462 19.8568C289.328 17.2021 289.736 14.5479 290.659 12.0555C291.583 9.56316 293.004 7.28462 294.836 5.35839C296.667 3.43215 298.872 1.89842 301.314 0.850407C303.757 -0.19761 306.388 -0.738037 309.046 -0.738037C311.704 -0.738037 314.334 -0.19761 316.777 0.850407C319.22 1.89842 321.424 3.43215 323.255 5.35839C325.087 7.28462 326.508 9.56316 327.432 12.0555C328.356 14.5479 328.763 17.2021 328.629 19.8568V69.7966C328.763 72.4513 328.356 75.1055 327.432 77.5979C326.508 80.0903 325.087 82.3688 323.255 84.295C321.424 86.2213 319.22 87.755 316.777 88.803C314.334 89.851 311.704 90.3915 309.046 90.3915C306.388 90.3915 303.757 89.851 301.314 88.803C298.872 87.755 296.667 86.2213 294.836 84.295C293.004 82.3688 291.583 80.0903 290.659 77.5979C289.736 75.1055 289.328 72.4513 289.462 69.7966V19.8568Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={8}>
            <path
              d="M434.317 50.1384C435.505 47.7652 437.165 45.6593 439.194 43.9496C441.224 42.2399 443.582 40.9623 446.122 40.195C448.663 39.4277 451.333 39.1868 453.97 39.4871C456.607 39.7874 459.155 40.6226 461.458 41.9415C463.761 43.2604 465.771 45.0353 467.364 47.1577C468.958 49.28 470.101 51.7052 470.725 54.2848C471.349 56.8643 471.44 59.5441 470.993 62.16C470.545 64.776 469.569 67.2732 468.123 69.4987L443.004 112.985C441.762 115.271 440.074 117.286 438.042 118.911C436.009 120.535 433.671 121.736 431.167 122.444C428.663 123.151 426.042 123.351 423.46 123.03C420.878 122.71 418.385 121.876 416.13 120.578C413.875 119.28 411.902 117.543 410.328 115.471C408.754 113.399 407.61 111.033 406.964 108.512C406.318 105.991 406.183 103.367 406.567 100.793C406.95 98.2193 407.845 95.7482 409.198 93.5254L434.317 50.0888V50.1384Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={10}>
            <path
              d="M544.423 148.926C548.906 146.332 554.235 145.626 559.239 146.962C564.243 148.297 568.512 151.566 571.105 156.049C573.699 160.532 574.406 165.862 573.07 170.866C571.734 175.87 568.465 180.138 563.982 182.732L520.545 207.851C518.325 209.155 515.87 210.008 513.321 210.364C510.771 210.719 508.176 210.568 505.685 209.92C503.193 209.273 500.854 208.141 498.8 206.589C496.746 205.037 495.017 203.096 493.714 200.876C492.41 198.656 491.556 196.202 491.201 193.652C490.846 191.102 490.996 188.507 491.644 186.016C492.292 183.524 493.424 181.185 494.975 179.131C496.527 177.077 498.469 175.348 500.688 174.045L544.423 148.926Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={4}>
            <path
              d="M590.391 289.512C593.046 289.378 595.7 289.785 598.193 290.709C600.685 291.633 602.963 293.054 604.89 294.886C606.816 296.717 608.35 298.922 609.398 301.364C610.446 303.807 610.986 306.437 610.986 309.095C610.986 311.754 610.446 314.384 609.398 316.827C608.35 319.269 606.816 321.474 604.89 323.305C602.963 325.137 600.685 326.558 598.193 327.482C595.7 328.405 593.046 328.813 590.391 328.679H540.203C537.549 328.813 534.894 328.405 532.402 327.482C529.91 326.558 527.631 325.137 525.705 323.305C523.779 321.474 522.245 319.269 521.197 316.827C520.149 314.384 519.608 311.754 519.608 309.095C519.608 306.437 520.149 303.807 521.197 301.364C522.245 298.922 523.779 296.717 525.705 294.886C527.631 293.054 529.91 291.633 532.402 290.709C534.894 289.785 537.549 289.378 540.203 289.512H590.391Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={5}>
            <path
              d="M559.861 434.367C562.199 435.578 564.268 437.25 565.943 439.282C567.617 441.313 568.863 443.663 569.605 446.189C570.348 448.716 570.571 451.366 570.262 453.981C569.953 456.595 569.118 459.12 567.807 461.404C566.496 463.687 564.736 465.682 562.634 467.267C560.531 468.852 558.13 469.995 555.574 470.628C553.018 471.26 550.361 471.369 547.762 470.947C545.163 470.525 542.676 469.581 540.451 468.173L496.965 443.054C494.614 441.855 492.531 440.192 490.842 438.165C489.152 436.138 487.891 433.789 487.136 431.261C486.38 428.733 486.145 426.077 486.445 423.456C486.745 420.834 487.574 418.301 488.882 416.008C490.189 413.716 491.948 411.713 494.052 410.12C496.155 408.527 498.561 407.378 501.121 406.741C503.682 406.105 506.346 405.994 508.95 406.417C511.555 406.839 514.047 407.785 516.276 409.198L559.713 434.317L559.861 434.367Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={6}>
            <path
              d="M461.124 544.423C463.717 548.906 464.424 554.236 463.088 559.24C461.752 564.244 458.483 568.512 454 571.106C449.517 573.699 444.187 574.406 439.183 573.07C434.179 571.734 429.911 568.465 427.318 563.982L402.099 520.545C400.796 518.326 399.942 515.871 399.587 513.321C399.232 510.771 399.382 508.177 400.03 505.685C400.677 503.193 401.809 500.854 403.361 498.8C404.913 496.746 406.854 495.018 409.074 493.714C413.557 491.081 418.902 490.336 423.934 491.644C426.426 492.292 428.765 493.424 430.819 494.976C432.873 496.528 434.602 498.469 435.906 500.689L461.024 544.175L461.124 544.423Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={7}>
            <path
              d="M320.538 590.391C320.671 593.046 320.264 595.7 319.34 598.193C318.416 600.685 316.995 602.964 315.164 604.89C313.332 606.816 311.128 608.35 308.685 609.398C306.242 610.446 303.612 610.986 300.954 610.986C298.296 610.986 295.666 610.446 293.223 609.398C290.78 608.35 288.576 606.816 286.744 604.89C284.913 602.964 283.492 600.685 282.568 598.193C281.644 595.7 281.237 593.046 281.37 590.391V540.203C281.237 537.549 281.644 534.895 282.568 532.402C283.492 529.91 284.913 527.631 286.744 525.705C288.576 523.779 290.78 522.245 293.223 521.197C295.666 520.149 298.296 519.609 300.954 519.609C303.612 519.609 306.242 520.149 308.685 521.197C311.128 522.245 313.332 523.779 315.164 525.705C316.995 527.631 318.416 529.91 319.34 532.402C320.264 534.895 320.671 537.549 320.538 540.203V590.391Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={8}>
            <path
              d="M175.683 559.862C172.993 564.11 168.767 567.156 163.886 568.363C159.005 569.571 153.846 568.848 149.485 566.344C145.125 563.841 141.899 559.75 140.482 554.926C139.064 550.102 139.564 544.916 141.876 540.452L166.995 496.965C168.163 494.563 169.812 492.427 171.84 490.688C173.867 488.95 176.23 487.646 178.782 486.858C181.334 486.069 184.021 485.813 186.676 486.106C189.331 486.398 191.897 487.233 194.216 488.558C196.536 489.882 198.558 491.669 200.158 493.808C201.759 495.946 202.903 498.39 203.521 500.989C204.138 503.587 204.215 506.285 203.747 508.914C203.28 511.544 202.277 514.05 200.801 516.276L175.683 559.713V559.862Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={9}>
            <path
              d="M65.5768 461.124C63.3571 462.408 60.9061 463.243 58.3638 463.58C55.8216 463.917 53.2379 463.75 50.7602 463.088C48.2825 462.427 45.9593 461.284 43.9234 459.724C41.8874 458.165 40.1785 456.22 38.8943 454C37.61 451.781 36.7755 449.33 36.4385 446.787C36.1015 444.245 36.2684 441.661 36.9299 439.184C37.5914 436.706 38.7345 434.383 40.2938 432.347C41.8531 430.311 43.7981 428.602 46.0179 427.318L89.3553 402.1C91.5815 400.796 94.0428 399.943 96.5985 399.591C99.1543 399.238 101.754 399.392 104.251 400.045C106.747 400.697 109.09 401.834 111.147 403.392C113.203 404.95 114.933 406.898 116.236 409.124C117.54 411.35 118.393 413.812 118.745 416.367C119.098 418.923 118.944 421.523 118.291 424.019C117.639 426.515 116.502 428.859 114.944 430.915C113.386 432.972 111.438 434.701 109.212 436.005L65.7257 461.124H65.5768Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={0}>
            <path
              d="M19.8566 320.538C17.2019 320.672 14.5477 320.264 12.0553 319.34C9.56291 318.417 7.28438 316.996 5.35814 315.164C3.4319 313.332 1.89818 311.128 0.850163 308.685C-0.197854 306.243 -0.738281 303.612 -0.738281 300.954C-0.738281 298.296 -0.197854 295.666 0.850163 293.223C1.89818 290.78 3.4319 288.576 5.35814 286.744C7.28438 284.913 9.56291 283.492 12.0553 282.568C14.5477 281.644 17.2019 281.237 19.8566 281.37H69.7964C72.4511 281.237 75.1053 281.644 77.5976 282.568C80.09 283.492 82.3686 284.913 84.2948 286.744C86.221 288.576 87.7548 290.78 88.8028 293.223C89.8508 295.666 90.3912 298.296 90.3912 300.954C90.3912 303.612 89.8508 306.243 88.8028 308.685C87.7548 311.128 86.221 313.332 84.2948 315.164C82.3686 316.996 80.09 318.417 77.5976 319.34C75.1053 320.264 72.4511 320.672 69.7964 320.538H19.8566Z"
              fill="#7A2727"
            />
          </SunRay>
          <SunRay delay={2}>
            <path
              d="M50.1382 175.683C47.7649 174.495 45.659 172.835 43.9493 170.805C42.2396 168.775 40.962 166.418 40.1947 163.878C39.4274 161.337 39.1866 158.667 39.4869 156.03C39.7872 153.393 40.6223 150.845 41.9413 148.542C43.2602 146.239 45.0351 144.229 47.1574 142.636C49.2798 141.042 51.7049 139.899 54.2845 139.275C56.8641 138.651 59.5438 138.56 62.1598 139.007C64.7757 139.455 67.2729 140.431 69.4985 141.877L112.985 166.995C115.271 168.238 117.286 169.925 118.91 171.958C120.535 173.991 121.736 176.329 122.444 178.833C123.151 181.337 123.351 183.957 123.03 186.54C122.71 189.122 121.876 191.615 120.578 193.87C119.279 196.125 117.543 198.098 115.471 199.672C113.399 201.246 111.033 202.39 108.512 203.036C105.991 203.682 103.367 203.817 100.793 203.433C98.219 203.049 95.748 202.155 93.5252 200.802L50.1382 175.683Z"
              fill="#7A2727"
            />
          </SunRay>
        </g>

        {/* Center circle group */}
        <g className="sun-center">
          <path
            d="M305.049 130.112C345.508 130.143 384.703 144.2 415.96 169.889C447.216 195.578 468.598 231.309 476.465 270.995C484.331 310.681 478.195 351.867 459.101 387.536C440.008 423.206 409.138 451.152 371.751 466.613C334.364 482.075 292.772 484.096 254.062 472.332C215.352 460.568 181.918 435.747 159.456 402.097C136.994 368.447 126.893 328.05 130.875 287.788C134.856 247.527 152.674 209.891 181.292 181.292C197.52 165.024 216.803 152.123 238.033 143.331C259.263 134.54 282.021 130.03 305 130.062L305.049 130.112Z"
            fill="#7A2727"
          />
        </g>
      </g>
      <defs>
        <clipPath id="clip0_2006_9">
          <rect fill="white" height="610" width="610" />
        </clipPath>
      </defs>
    </svg>
  )
}

const SkyBackground = () => {
  return (
    <div className="relative overflow-hidden pt-[50px] bg-slate-400">
      <div className="upper-sky h-[456px]">
        <Sun />
      </div>

      <div className="bottom-sky absolute bottom-[-40px] left-[-120px] w-full z-0">
        <svg
          fill="none"
          height="456"
          preserveAspectRatio="none"
          viewBox="0 0 5120 456"
          width="5120"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M2467 198C2478.93 198 2508.5 148.5 2692.3 167C2855.77 183.454 2890 275.92 2940.45 271C2978.5 267.29 3025.5 66.1073 3208.04 55.5002C3364.5 46.408 3407.37 123 3419.5 123.5C3431.63 124 3448.89 83.0002 3564.32 83.0002C3728 83.0002 3767.67 198.501 3779.08 198C3790.5 197.5 3808 45.0002 4044.68 45.0002C4238.5 45.0002 4245.32 120.5 4256.5 116.5C4267.69 112.5 4277 13.5002 4417.9 13.5002C4567 13.5002 4590.74 115.5 4608.5 116.5C4626.26 117.5 4640.5 13.5007 4795 13.5004C4946 13.5002 4954.43 76.5003 4970.51 76.5003C4986.6 76.5003 4983 8.5 5077 8.5C5147.13 8.5 5148.62 62.7657 5148.14 74.3437C5148.08 75.8075 5148 77.2344 5148 78.6994V360V361.5C5148 383.592 5130.09 401.5 5108 401.5H9C-13.0914 401.5 -31 383.592 -31 361.5V133.5V76.0021V76.0002C-31 75.9604 -30.9925 -7.80104e-05 24 0C103.747 0.000113126 132.617 67.9717 143.069 117.186C148.413 142.347 172.927 161.481 197.99 155.7L478.5 91C598.5 64.5 646 110.5 659 110.5C672 110.5 714 31 856 33.5C998 36 996.5 76 1008.5 73.5C1020.5 71 1014.28 28.0329 1174.5 31C1309.5 33.5 1298.5 110.5 1327.5 110.5C1366.31 110.5 1378.25 109.457 1388 110.5C1406.69 112.5 1429.5 27 1615 27C1743.74 27 1771.09 161.183 1855.16 167C1930.28 172.198 1914.5 85 2032.05 90.0002C2108.93 93.2702 2132.33 148 2146.16 148C2160 148 2184 81.6655 2318.08 102.5C2440.5 121.524 2455.07 198 2467 198Z"
            fill="#0f1824"
          />
          <path
            d="M2617 234C2496.99 229.765 2429.72 276.108 2400.53 303.732C2388.43 315.177 2372.83 323.5 2356.18 323.5H2135.62C2111.05 323.5 2089.95 305.704 2082.79 282.198C2061.56 212.504 2001.53 78.3592 1852.75 71.0003C1691 63 1645 185 1622 186.5C1599 188 1587 88.5 1368.5 88.5C1211 88.5 1180 157.5 1158.4 161.5C1136.8 165.501 1074.33 111 931 129.5C787.671 148 789.676 214.5 770 214C750.324 213.5 736.5 129.5 535.029 142.5C416.863 150.125 382.163 211.07 373.669 260.166C368.141 292.123 343.421 323.5 310.99 323.5H280.024C249.079 323.5 225.052 295.503 224.331 264.567C222.732 195.98 200.305 92 79 92C17.4738 92 3.47982 128.37 0.653094 139.38C0.122368 141.447 0 143.571 0 145.705V398C0 412.36 11.6404 424 25.9998 424H5100C5127.61 424 5150 401.615 5150 374V365V181.851C5150 149.381 5119.54 125.514 5087.89 132.773C5054.67 140.392 5019.02 148.008 5011.31 147.5C4996.11 146.501 4966.41 99.9071 4859.43 95.5003C4731 90.2096 4684 213.5 4663 213.5H4531.84C4513.48 213.5 4496.63 203.435 4485.66 188.715C4451.8 143.286 4365.08 52.9127 4220.67 71.0003C4061 91.0002 4023.5 150.5 4006.5 150.5C3989.5 150.5 3925.6 96.5092 3797.5 100.5C3637 105.5 3599 235.5 3589 231.5C3563.12 221.148 3430.32 192.596 3405.38 180.145C3382.96 168.954 3354.61 161.5 3318.87 161.5C3175.43 161.5 3129.73 224 3116.87 224C3104 224 3073.62 179.5 2953.5 179.5C2782 179.5 2771.92 286 2756 284.5C2740.08 283 2721.1 237.674 2617 234Z"
            fill="#0d0f12"
          />
        </svg>
      </div>
      <div className="container max-w-6xl absolute w-full h-full top-0 right-0 z-10">
        <LazyVoxelDog className="" />
      </div>
    </div>
  )
}

export default SkyBackground
